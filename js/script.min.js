let gData,gRegions=[];const REGION_THRESHOLD=10,COLORS={default:"#3DC",dark:"#399",patient:"#ED9",discharge:"#3CA",test:"#3DC",dead:"#E95",positive:"#E95",selected:"#EC2",gender:{f:"#FE9",m:"#2B9"}},init=()=>{const a=()=>{let a=$("#patients-chart");a.empty(),a.html("<canvas></canvas>");let t=a.find("canvas")[0],e={type:"bar",data:{labels:[],datasets:[{label:"死亡数",backgroundColor:COLORS.dead,borderColor:"transparent",data:[]},{label:"退院数",backgroundColor:COLORS.discharge,borderColor:"transparent",data:[]},{label:"患者数",backgroundColor:COLORS.patient,borderColor:"transparent",data:[]}]},options:{aspectRatio:1.2,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!1,callbacks:{title:function(a){return a[0].xLabel+" "+gData.transition[a[0].index][2]+":00時点"},label:function(a,t){let e=gData.transition[a.index],o=["患者数："+e[5]+"名"];return o.push("　うち退院："+e[6]+"名"),o.push("　同　死亡："+e[7]+"名"),o}}},scales:{xAxes:[{stacked:!0,gridLines:{display:!1},ticks:{fontColor:"rgba(255,255,255,0.7)"}}],yAxes:[{location:"bottom",stacked:!1,gridLines:{display:!0,color:"rgba(255, 255, 255, 0.3)"},ticks:{beginAtZero:!0,fontColor:"rgba(255,255,255,0.7)",callback:function(a,t,e){return a.toString()+" 名"}}}]}}};a.width()>=400&&(e.options.aspectRatio=1.5),a.width()>=600&&(e.options.aspectRatio=1.8),gData.transition.forEach(function(a,t){if(e.data.labels.push(a[0]+"/"+a[1]),"new"===$("#patients-block").find(".switch.selected").attr("value")&&t>=1){let o=gData.transition[t-1];e.data.datasets[2].data.push(a[5]-o[5]),e.data.datasets[1].data.push(a[6]-o[6]),e.data.datasets[0].data.push(a[7]-o[7])}else e.data.datasets[2].data.push(a[5]),e.data.datasets[1].data.push(a[6]),e.data.datasets[0].data.push(a[7])});let o=t.getContext("2d");window.myChart=new Chart(o,e)},t=()=>{let a=$("#surveys-chart");a.empty(),a.html("<canvas></canvas>");let t=a.find("canvas")[0],e={type:"bar",data:{labels:[],datasets:[{label:"有症数＝患者数",backgroundColor:COLORS.patient,borderColor:"transparent",data:[]},{label:"陽性者数",backgroundColor:COLORS.positive,borderColor:"transparent",data:[]},{label:"検査数",backgroundColor:COLORS.test,borderColor:"transparent",data:[]}]},options:{aspectRatio:1.2,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!1,callbacks:{title:function(a){return a[0].xLabel+" "+gData.transition[a[0].index][2]+":00時点"},label:function(a,t){let e=gData.transition[a.index],o=["PCR検査数："+e[3]+"名"];return o.push("　うち陽性："+e[4]+"名"),o.push("　同　有症："+e[5]+"名"),o}}},scales:{xAxes:[{stacked:!0,gridLines:{display:!1},ticks:{fontColor:"rgba(255,255,255,0.7)"}}],yAxes:[{location:"bottom",stacked:!1,gridLines:{display:!0,color:"rgba(255, 255, 255, 0.3)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(a,t,e){return a.toString()+" 名"}}}]}}};a.width()>=400&&(e.options.aspectRatio=1.5),a.width()>=600&&(e.options.aspectRatio=1.8),gData.transition.forEach(function(a,t){if(e.data.labels.push(a[0]+"/"+a[1]),"new"===$("#surveys-block").find(".switch.selected").attr("value")&&t>=1){let o=gData.transition[t-1];e.data.datasets[2].data.push(a[3]-o[3]),e.data.datasets[1].data.push(a[4]-o[4]),e.data.datasets[0].data.push(a[5]-o[5])}else e.data.datasets[2].data.push(a[3]),e.data.datasets[1].data.push(a[4]),e.data.datasets[0].data.push(a[5])});let o=t.getContext("2d");window.myChart=new Chart(o,e)},e=a=>{let t="rgba(90, 90, 90, 0.3)";return a>=1&&(t=COLORS.dark),a>=10&&(t=COLORS.default),t},o=a=>{let t=$("#region-chart");t.empty(),t.html("<canvas></canvas>");let o=t.find("canvas")[0],s={type:"horizontalBar",data:{labels:[],datasets:[{label:"",backgroundColor:[],data:[]}]},options:{aspectRatio:.8,animation:{duration:1e3},responsive:!0,legend:{display:!1},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(a){return a[0].yLabel},label:function(a,t){return a.xLabel+"名"}}},scales:{xAxes:[{position:"top",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(a,t,e){return a.toString()+" 名"}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)"}}]}}};t.outerWidth()>=400&&(s.options.aspectRatio=1),t.outerWidth()>=600&&(s.options.aspectRatio=1.2),""!==a&&(s.options.animation.duration=0),gData.prefectures.forEach(function(t,o){t.value>=1&&(s.data.labels.push(t.jp),s.data.datasets[0].data.push(t.value),a===t.code?s.data.datasets[0].backgroundColor.push(COLORS.selected):s.data.datasets[0].backgroundColor.push(e(t.value)))});let n=o.getContext("2d");window.myChart=new Chart(n,s)};$.getJSON("data/data.json",function(s){gData=s,t(),a(),(()=>{$wrapper=$("#demography-chart"),$wrapper.empty(),$wrapper.html("<canvas></canvas>"),$canvas=$wrapper.find("canvas")[0];let a={type:"horizontalBar",data:{labels:[],datasets:[{label:"女性",backgroundColor:COLORS.gender.f,data:[]},{label:"男性",backgroundColor:COLORS.gender.m,data:[]}]},options:{aspectRatio:.9,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(a){return a[0].yLabel},label:function(a,t){return t.datasets[a.datasetIndex].label+"："+a.value+"名"}}},scales:{xAxes:[{position:"top",color:"yellow",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(a,t,e){return a.toString()+" 名"}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)"}}]}}};$wrapper.outerWidth()>=400&&(a.options.aspectRatio=1.1),$wrapper.outerWidth()>=600&&(a.options.aspectRatio=1.3);let t=0;for(let e in gData.demography){for(let o in gData.demography[e]){let s=gData.demography[e][o];0===t&&a.data.labels.push(o),a.data.datasets[t].data.push(s)}t++}let e=$canvas.getContext("2d");window.myChart=new Chart(e,a)})(),(()=>{const a=$("#japan-map").width();let t=[];gData.prefectures.forEach(function(a,o){t.push({code:a.code,jp:a.jp,en:a.en,color:e(a.value),hoverColor:COLORS.selected,prefectures:[a.code]})}),$("#japan-map").japanMap({areas:t,width:a,borderLineColor:"#fcfcfc",borderLineWidth:.25,lineColor:"#ccc",lineWidth:1,drawsBoxLine:!1,showsPrefectureName:!1,movesIslands:!0,fontSize:11,onHover:function(a){o(a.code,0)}})})(),o(""),$("#container").addClass("show")}),$(".switch").on("click",function(){$(this).siblings(".switch").removeClass("selected"),$(this).addClass("selected"),$(this).closest("#patients-block")[0]&&a(),$(this).closest("#surveys-block")[0]&&t()})};$(function(){init()});