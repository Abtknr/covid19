let gData,gRegions=[];const LAST_DATE="2020-02-26T00:00:00+09:00",AGE_LABELS=["80代","70代","60代","50代","40代","30代","20代","10代","10歳未満"],COLORS={default:"#3dc",gender:{f:"#FE9",m:"#2B9"}},init=()=>{const e=()=>{const e=()=>{let e=[],o=new Date("2020-01-15T00:00:00+09:00"),r=new Date(LAST_DATE);for(let t=o;t<=r;t.setDate(t.getDate()+1)){let o=t.getMonth()+1,r=t.getDate(),a=o.toString()+"/"+r.toString();e.push(a)}return e};let o=$("#transition-chart");o.empty(),o.html("<canvas></canvas>");let r=o.find("canvas")[0],t={type:"bar",data:{labels:e(),datasets:[{label:"患者数",backgroundColor:COLORS.default,data:[]}]},options:{aspectRatio:1.2,responsive:!0,legend:{display:!1},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(e){return e[0].xLabel},label:function(e,o){return e.yLabel+"名"}}},scales:{xAxes:[{stacked:!0,gridLines:{display:!1},ticks:{fontColor:"rgba(255,255,255,0.7)"}}],yAxes:[{location:"bottom",stacked:!0,gridLines:{display:!0,color:"rgba(255, 255, 255, 0.3)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(e,o,r){return e.toString()+" 名"}}}]}}};o.width()>=400&&(t.options.aspectRatio=1.5),o.width()>=600&&(t.options.aspectRatio=1.8);let a=[];e().forEach(function(e,o){a.push(0)}),gData.forEach(function(o,r){e().forEach(function(e,r){if(o[3]===e)if("total"===$("#transition-block").find(".switch.selected").attr("value"))for(let e=r;e<a.length;e++)a[e]++;else a[r]++})}),t.data.datasets[0].data=a;let c=r.getContext("2d");window.myChart=new Chart(c,t)};$.getJSON("data/data.json",function(o){gData=o,e(),(()=>{const e=e=>("東京"===e&&(e="東京都"),"京都"===e&&(e="京都府"),"大阪"===e&&(e="大阪府"),"東京都"!==e&&"大阪府"!==e&&"京都府"!==e&&"北海道"!==e&&"調査中"!==e&&"県"!==e.slice(-1)&&(e+="県"),-1!==e.indexOf("中国")&&(e="中国居住者"),e);let o=$("#region-chart");o.empty(),o.html("<canvas></canvas>");let r=o.find("canvas")[0];gData.forEach(function(o,r){let t=-1;gRegions.forEach(function(r,a){r.label==e(o[6])&&(t=a)}),t>=0?gRegions[t].value++:gRegions.push({label:e(o[6]),value:1})}),gRegions.sort(function(e,o){return e.value<=o.value?1:-1});let t=[],a=[],c=[];gRegions.forEach(function(e,o){t.push(e.label),a.push(e.value),"中国居住者"===e.label||"調査中"===e.label?c.push("rgba(255,255,255,0.4)"):c.push(COLORS.default)});let l={type:"horizontalBar",data:{labels:t,datasets:[{label:"",backgroundColor:c,data:a}]},options:{aspectRatio:1,responsive:!0,legend:{display:!1},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(e){return e[0].yLabel},label:function(e,o){return e.xLabel+"名"}}},scales:{xAxes:[{position:"top",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(e,o,r){return e.toString()+" 名"}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)"}}]}}};o.outerWidth()>=400&&(l.options.aspectRatio=1.2),o.outerWidth()>=600&&(l.options.aspectRatio=1.4);let n=r.getContext("2d");window.myChart=new Chart(n,l)})(),(()=>{const e=e=>{let o="#666";return gRegions.forEach(function(r,t){r.label===e&&(o=COLORS.default)}),o};let o=$("#japan-map").width(),r=[{code:1,jp:"北海道",en:"Hokkaido",color:e("北海道"),hoverColor:e("北海道"),prefectures:[1]},{code:2,jp:"青森県",en:"Aomori",color:e("青森県"),hoverColor:e("青森県"),prefectures:[2]},{code:3,jp:"岩手県",en:"Iwate",color:e("岩手県"),hoverColor:e("岩手県"),prefectures:[3]},{code:4,jp:"宮城県",en:"Miyagi",color:e("宮城県"),hoverColor:e("宮城県"),prefectures:[4]},{code:5,jp:"秋田県",en:"Akita",color:e("秋田県"),hoverColor:e("秋田県"),prefectures:[5]},{code:6,jp:"山形県",en:"Yamagata",color:e("山形県"),hoverColor:e("山形県"),prefectures:[6]},{code:7,jp:"福島県",en:"Fukushima",color:e("福島県"),hoverColor:e("福島県"),prefectures:[7]},{code:8,jp:"茨城県",en:"Ibaraki",color:e("茨城県"),hoverColor:e("茨城県"),prefectures:[8]},{code:9,jp:"栃木県",en:"Tochigi",color:e("栃木県"),hoverColor:e("栃木県"),prefectures:[9]},{code:10,jp:"群馬県",en:"Gunma",color:e("群馬県"),hoverColor:e("群馬県"),prefectures:[10]},{code:11,jp:"埼玉県",en:"Saitama",color:e("埼玉県"),hoverColor:e("埼玉県"),prefectures:[11]},{code:12,jp:"千葉県",en:"Chiba",color:e("千葉県"),hoverColor:e("千葉県"),prefectures:[12]},{code:13,jp:"東京都",en:"Tokyo",color:e("東京都"),hoverColor:e("東京都"),prefectures:[13]},{code:14,jp:"神奈川県",en:"Kanagawa",color:e("神奈川県"),hoverColor:e("神奈川県"),prefectures:[14]},{code:15,jp:"新潟県",en:"Niigata",color:e("新潟県"),hoverColor:e("新潟県"),prefectures:[15]},{code:16,jp:"富山県",en:"Toyama",color:e("富山県"),hoverColor:e("富山県"),prefectures:[16]},{code:17,jp:"石川県",en:"Ishikawa",color:e("石川県"),hoverColor:e("石川県"),prefectures:[17]},{code:18,jp:"福井県",en:"Fukui",color:e("福井県"),hoverColor:e("福井県"),prefectures:[18]},{code:19,jp:"山梨県",en:"Yamanashi",color:e("山梨県"),hoverColor:e("山梨県"),prefectures:[19]},{code:20,jp:"長野県",en:"Nagano",color:e("長野県"),hoverColor:e("長野県"),prefectures:[20]},{code:21,jp:"岐阜県",en:"Gifu",color:e("岐阜県"),hoverColor:e("岐阜県"),prefectures:[21]},{code:22,jp:"静岡県",en:"Shizuoka",color:e("静岡県"),hoverColor:e("静岡県"),prefectures:[22]},{code:23,jp:"愛知県",en:"Aichi",color:e("愛知県"),hoverColor:e("愛知県"),prefectures:[23]},{code:24,jp:"三重県",en:"Mie",color:e("三重県"),hoverColor:e("三重県"),prefectures:[24]},{code:25,jp:"滋賀県",en:"Shiga",color:e("滋賀県"),hoverColor:e("滋賀県"),prefectures:[25]},{code:26,jp:"京都府",en:"Kyoto",color:e("京都府"),hoverColor:e("京都府"),prefectures:[26]},{code:27,jp:"大阪府",en:"Osaka",color:e("大阪府"),hoverColor:e("大阪府"),prefectures:[27]},{code:28,jp:"兵庫県",en:"Hyogo",color:e("兵庫県"),hoverColor:e("兵庫県"),prefectures:[28]},{code:29,jp:"奈良県",en:"Nara",color:e("奈良県"),hoverColor:e("奈良県"),prefectures:[29]},{code:30,jp:"和歌山県",en:"Wakayama",color:e("和歌山県"),hoverColor:e("和歌山県"),prefectures:[30]},{code:31,jp:"鳥取県",en:"Tottori",color:e("鳥取県"),hoverColor:e("鳥取県"),prefectures:[31]},{code:32,jp:"島根県",en:"Shimane",color:e("島根県"),hoverColor:e("島根県"),prefectures:[32]},{code:33,jp:"岡山県",en:"Okayama",color:e("岡山県"),hoverColor:e("岡山県"),prefectures:[33]},{code:34,jp:"広島県",en:"Hiroshima",color:e("広島県"),hoverColor:e("広島県"),prefectures:[34]},{code:35,jp:"山口県",en:"Yamaguchi",color:e("山口県"),hoverColor:e("山口県"),prefectures:[35]},{code:36,jp:"徳島県",en:"Tokushima",color:e("徳島県"),hoverColor:e("徳島県"),prefectures:[36]},{code:37,jp:"香川県",en:"Kagawa",color:e("香川県"),hoverColor:e("香川県"),prefectures:[37]},{code:38,jp:"愛媛県",en:"Ehime",color:e("愛媛県"),hoverColor:e("愛媛県"),prefectures:[38]},{code:39,jp:"高知県",en:"Kochi",color:e("高知県"),hoverColor:e("高知県"),prefectures:[39]},{code:40,jp:"福岡県",en:"Fukuoka",color:e("福岡県"),hoverColor:e("福岡県"),prefectures:[40]},{code:41,jp:"佐賀県",en:"Saga",color:e("佐賀県"),hoverColor:e("佐賀県"),prefectures:[41]},{code:42,jp:"長崎県",en:"Nagasaki",color:e("長崎県"),hoverColor:e("長崎県"),prefectures:[42]},{code:43,jp:"熊本県",en:"Kumamoto",color:e("熊本県"),hoverColor:e("熊本県"),prefectures:[43]},{code:44,jp:"大分県",en:"Oita",color:e("大分県"),hoverColor:e("大分県"),prefectures:[44]},{code:45,jp:"宮崎県",en:"Miyazaki",color:e("宮崎県"),hoverColor:e("宮崎県"),prefectures:[45]},{code:46,jp:"鹿児島県",en:"Kagoshima",color:e("鹿児島県"),hoverColor:e("鹿児島県"),prefectures:[46]},{code:47,jp:"沖縄県",en:"Okinawa",color:e("沖縄県"),hoverColor:e("沖縄県"),prefectures:[47]}];$("#japan-map").japanMap({areas:r,width:o,borderLineColor:"#fcfcfc",borderLineWidth:.25,lineColor:"#ccc",lineWidth:1,drawsBoxLine:!1,showsPrefectureName:!1,movesIslands:!0,fontSize:11})})(),(()=>{$wrapper=$("#age-chart"),$wrapper.empty(),$wrapper.html("<canvas></canvas>"),$canvas=$wrapper.find("canvas")[0];let e={f:[0,0,0,0,0,0,0,0,0,0],m:[0,0,0,0,0,0,0,0,0,0]};gData.forEach(function(o,r){let t,a=-1;"男"==o[5]&&(t="m"),"女"==o[5]&&(t="f"),AGE_LABELS.forEach(function(e,r){o[4]===e&&(a=r)}),t&&a>=0&&e[t][a]++});let o={type:"horizontalBar",data:{labels:AGE_LABELS,datasets:[{label:"女性",backgroundColor:COLORS.gender.f,data:e.f},{label:"男性",backgroundColor:COLORS.gender.m,data:e.m}]},options:{aspectRatio:1,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(e){return e[0].yLabel},label:function(e,o){return o.datasets[e.datasetIndex].label+"："+e.value+"名"}}},scales:{xAxes:[{position:"top",color:"yellow",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(e,o,r){return e.toString()+" 名"}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)"}}]}}};$wrapper.outerWidth()>=400&&(o.options.aspectRatio=1.2),$wrapper.outerWidth()>=600&&(o.options.aspectRatio=1.4);let r=$canvas.getContext("2d");window.myChart=new Chart(r,o)})(),$("#container").addClass("show")}),$("#transition-block").find(".switch").on("click",function(){$("#transition-block").find(".switch").removeClass("selected"),$(this).addClass("selected"),e()})};$(function(){init()});